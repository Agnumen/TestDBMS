Что?

Телеграм-эхо-бот с полноценной базой данных.
Чтобы что?

Чтобы показать принципы работы с реляционной БД в связке с aiogram.
Что бот должен уметь?

    Отправлять пользователю обратно его же сообщения (эхо-бот).
    Добавлять новых пользователей в базу данных.
    Собирать статистику активности пользователей.
    Запоминать выбор языка пользователя и отображать интерфейс на этом языке.

Дополнительный функционал

    По запросу админа выводить статистику активности пользователей.
    Давать админу возможность банить и снимать бан с пользователей.

Стек

    aiogram
    Docker
    SQLAlchemy (PostgreSQL)
    Pydantic
    alembic
    Redis

Описание взаимодействия с ботом

    Пользователь отправляет команду /start боту (или стартует его, найдя в поиске):
        Бот приветствует пользователя и сообщает, что создан для демонстрации работы с реляционными СУБД, также предлагает пользователю прочитать краткую справку через отправку команды /help.

        Бот добавляет пользователя в таблицу users, если такого пользователя ещё не было, устанавливая язык, указанный в апдейте. Устанавливает роль user, если пользователя нет в списке админов, и admin, если есть. Устанавливает статусы is_alive=true, banned=false, а также указывает время создания записи в поле created_at.
        Бот добавляет запись о пользователе в таблицу activity, устанавливая значение actions=1 и текущую дату, если пользователь взаимодействовал с ботом первый раз за день. Если же это не первый раз в течение этого дня, то прибавляя 1 к значению поля actions.
        Бот устанавливает пользователю кнопку Menu с описанием команд на языке пользователя.

    На этом этапе пользователь с ролью user может совершить 5 действий:
        Отправить в чат команду /help.
        Отправить в чат команду /start.
        Отправить в чат команду /lang.
        Отправить в чат любое другое сообщение.
        Заблокировать бота.
    Пользователь с ролью admin, на данном этапе, может совершить следующие действия:
        Любые действия, доступные пользователю с ролью user.
        Отправить в чат команду /ban с юзернеймом или user_id пользователя, которого нужно забанить.
        Отправить в чат команду /unban с юзернеймом или user_id пользователя, которого нужно разбанить.
        Отправить в чат команду /statistics.
    Пользователь отправляет в чат команду /help:
        Бот присылает справочное сообщение о своём функционале со списком доступных команд.

        Бот добавляет в таблицу activity запись о пользователе, устанавливая значение actions=1 и текущую дату, если пользователь взаимодействовал с ботом первый раз за день. Если же это не первый раз в течение этого дня, то прибавляя 1 к значению поля actions.
    Пользователь отправляет в чат команду /start:
        Действия бота те же, что и первоначальной отправке пользователем команды /start.
    Пользователь отправляет в чат команду /lang:
        Бот отправляет пользователю сообщение с предложением установить предпочтительный язык интерфейса (русский или английский), радио-кнопки с выбором языка, а также кнопки "Сохранить" и "Отмена".

            Пользователь переключается между языками, нажимая радио-кнопки:
                Бот меняет язык сообщения с кнопками на язык, соответствующий нажатой радио-кнопке.

            Пользователь нажимает кнопку "Сохранить":
                Бот меняет в таблице users язык на выбранный, если язык отличается от изначально установленного, а если не отличается, соответственно, не меняет.
                Бот редактирует сообщение с кнопками, сообщая, что выбранный язык успешно установлен и дальнейшие тексты интерфейса будут отображаться на нём, и предлагая отправить команду /help. Также бот удаляет кнопки из сообщения.

                Бот устанавливает пользователю описание команд в кнопке Menu на установленном языке.

            Пользователь нажимает кнопку "Отмена":
                Бот редактирует сообщение с кнопками, сообщая, что язык остался прежним и предлагая отправить команду /help. Также бот удаляет кнопки из сообщения.

            Пользователь отправляет команду /start:
                Бот редактирует сообщение с кнопками выбора языка, удаляя кнопки, а дальше действует по сценарию первоначальной обработки команды /start.
            Пользователь оправляет любые другие сообщения:
                Бот редактирует сообщение с кнопками выбора языка, удаляя из него кнопки.
                Бот переотправляет сообщение с кнопками, чтобы оно было последним сообщением в чате и давало пользователю понять, что сейчас он находится в режиме выбора языка.

    Пользователь отправляет в чат любое другое сообщение:
        Бот отправляет копию сообщения пользователя обратно.

    Пользователь блокирует бота:
        Бот меняет пользователю статус is_alive в таблице users на false.
    Пользователь c ролью admin совершает действия, доступные пользователю с ролью user:
        Реакции бота точно такие же, как и на действия пользователя с ролью user, сообщение на команду /help отличается расширенным списком доступных команд.
    Пользователь с ролью admin отправляет в чат команду /ban с юзернеймом или user_id пользователя. Юзернейм должен начинаться с символа @, а user_id быть числом:
        Если команда /ban приходит без параметров или с параметрами неизвестного формата, то бот сообщает админу, что не знает кого банить и нужно отправить команду в ожидаемом формате.

        Если первым аргументом команды /ban является число или если первым символом аргумента является @, то бот ищет в таблице users пользователя по user_id или юзернейму. Если находит:
            Устанавливает пользователю в поле banned значение true, если до этого было false.
                Сообщает админу, что пользователь успешно забанен.

            Если значение в поле banned и так было true:
                Сообщает админу, что пользователь уже и так забанен.

        Если НЕ находит:
            Сообщает админу, что пользователь не найден.

    Пользователь с ролью admin отправляет в чат команду /unban с юзернеймом или user_id пользователя. Юзернейм должен начинаться с символа @, а user_id быть числом:
        Если команда /unban приходит без параметров или с параметрами неизвестного формата, то бот сообщает админу, что не знает кого нужно разбанить и что команда должна быть в ожидаемом формате.

        Если первым аргументом команды /unban является число или если первым символом аргумента является @, то бот ищет в таблице users пользователя по user_id или юзернейму. Если находит:
            Устанавливает пользователю в поле banned значение false, если до этого было true.
                Сообщает админу, что пользователь успешно разбанен.

            Если значение в поле banned итак было false:
                Сообщает админу, что пользователь не был забанен.

        Если первым аргументом команды /unban является число или если первым символом аргумента является @, то бот ищет в таблице users пользователя по user_id или юзернейму. Если НЕ находит:
            Сообщает админу, что пользователь не найден.

    Пользователь c ролью admin отправляет в чат команду /statistics:
        Бот присылает в чат админу статистику по 5 самым активным пользователям (количество действий в боте). 